# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a Vue 3 + TypeScript frontend application for MarketWatch, integrating with an ABP Framework backend via OAuth authentication. The app displays stock market data, charts, and trading strategies.

The backend code is at ../MarketWatchWeb_AbpBackEnd
The backend code uses Abp Framework
EF core is used with migration. Do not manually update migration file, which should be generated by migration tool. 

## Agent instruction
- Always create a todo list and process it one by one
- Choose the simplest solution
- After implementation, update CLAUDE.md if needed. CLAUD.md needs to to high-level and concise

## Development Commands

**Development server:**
```bash
npm run dev
```
Runs on https://localhost:4200 with auto-generated SSL certificates (via vite-plugin-mkcert)

**Build for production:**
```bash
npm run build
```
Runs type checking in parallel with the Vite build

**Type checking only:**
```bash
npm run type-check
```

**Linting:**
```bash
npm run lint
```
Auto-fixes issues where possible

**Testing:**
```bash
npm run test:unit              # Run Vitest unit tests
npm run test:e2e               # E2E tests with Cypress (interactive)
npm run test:e2e:ci            # E2E tests (headless)
```

## Architecture

### Authentication Flow
- OAuth/OIDC authentication via `vue-oidc-client` library
- Identity server configured in [src/core/config/globalConfig.ts](src/core/config/globalConfig.ts) (`APIServer: "https://localhost:44324"`)
- Authentication setup in [src/idsrvAuth.ts](src/idsrvAuth.ts) - creates OIDC auth instance with ABP-specific configuration
- App initialization in [src/main.ts](src/main.ts) waits for `idsrvAuth.startup()` before mounting
- Protected routes require `meta.authName` set to `idsrvAuth.authName` in router config

### API Communication
- Centralized API service: [src/core/services/apiService.ts](src/core/services/apiService.ts)
- Automatically injects Bearer token from OIDC auth into all axios requests
- Base URL configured via `GlobalConfig.APIServer`
- Methods: `get()`, `post()`, `update()`, `delete()`
- marketWatchClient.ts is auto-generated from backend. Run "G:\SourceCode\MarketWatchWeb_AbpBackEnd\src\MarketWatchWeb.HttpApi.Host\CreateClient.bat"

### Directory Structure
```
src/
├── core/
│   ├── config/          # Global configuration (API endpoints)
│   └── services/        # API service layer
├── views/               # Page components (HomeView, StockPrice, StockChart, etc.)
├── components/          # Reusable components
│   ├── PageHeader.vue   # Consistent page header with title, subtitle, search, and actions
│   ├── StatusBadge.vue  # Colored status badges (active, pending, cancelled, delay)
│   ├── FilterBar.vue    # Filter controls for tables
│   └── HeaderComponent.vue  # Main navigation header
├── router/              # Vue Router configuration
├── assets/              # Static assets, CSS (including main.css for Tailwind)
├── idsrvAuth.ts         # OIDC authentication setup
├── main.ts              # App initialization and plugin registration
└── vue-oidc-client.ts   # OIDC client wrapper
```

### Styling
- Tailwind CSS v4 (requires `@tailwindcss/postcss` plugin in [postcss.config.js](postcss.config.js))
- Element Plus UI library globally registered
- PrimeVue components available
- Modern table styling with:
  - Subtle borders and hover effects
  - Consistent filter bars with search, dropdowns, and action buttons
  - Status badges with colored dots (green=Active, orange=Pending, red=Cancelled, purple=Delay)
  - Clean typography and spacing
  - Responsive design patterns

### Routing
Protected routes (all except home) require authentication and use lazy loading for code splitting.

### Data Entities
- **Company** entity mapped to `Companys` table - provides comprehensive financial data (market cap, P/E ratio, EPS, sector, etc.)
- **StockInfo** entity for basic stock information
- **StockPrice** entity for historical price data

Recent additions:
- `GET /strategyHistory` route renders Strategy trade history list (from `tblFundTradeHistory`)
- StockChart page now displays financial overview section with key metrics from Company entity
- `/strategy` route (StrategyView) uses `tblFundStrategy` with Name column and Edit functionality
- `/simulate/strategy` route (SimulateStrategy) uses `Strategy` table for simulation strategies
- **Parameter Optimization System** - Automated parameter optimization with background job queue (see below)

## Key Configuration Files
- [vite.config.ts](vite.config.ts) - Vite config with HTTPS enabled, alias `@` → `./src`
- [postcss.config.js](postcss.config.js) - PostCSS with Tailwind v4 (`@tailwindcss/postcss`)
- [tsconfig.json](tsconfig.json), [tsconfig.app.json](tsconfig.app.json), [tsconfig.vitest.json](tsconfig.vitest.json) - TypeScript configs

## Coding Standards
- Vue 3 Composition API with TypeScript
- Use Tailwind CSS for styling
- Keep implementations simple and straightforward
- Do not create a EF migration. Skip it. 

## Parameter Optimization System

**Purpose:** Automatically find the best strategy parameters by testing hundreds of combinations systematically.

### Architecture
- **Backend** (ABP Framework):
  - `OptimizationJob` entity - Stores optimization job configuration and results
  - `SimulationQueue` entity - Individual simulations in the queue
  - `OptimizationJobAppService` - Creates jobs, generates parameter combinations
  - `SimulationQueueWorker` - Background worker that runs simulations asynchronously
  - Tables: `OptimizationJobs`, `SimulationQueue`

- **Frontend** (Vue 3):
  - `/optimization/config` - Configure and start new optimization jobs
  - `/optimization/monitor` - Monitor running jobs and view results
  - Integration with existing `/simulate/run` page to use optimized parameters

### Optimization Methods
1. **Smart Grid Search** (Recommended) - Seeds from top historical performers, then coarse grid
2. **Walk-Forward Analysis** - Rolling time windows to prevent overfitting
3. **Grid Search** - Exhaustive parameter combination testing

### Parameters Optimized
- Analysis Period, Correlation Threshold, Entry Trigger, Stop Loss
- Portfolio Size, Trade Fee, Slippage, Trend Filter settings

### Usage Flow
1. Configure optimization (method, parameter ranges, date range)
2. System generates 100-500 simulation combinations
3. Background worker processes queue (one at a time)
4. Monitor dashboard shows real-time progress
5. Review top 10 performers sorted by Sharpe ratio
6. Click "Use These" to apply best parameters to Run Simulation

### Setup Required
1. Create EF migration for new tables (see `../MarketWatchWeb_AbpBackEnd/OPTIMIZATION_SETUP.md`)
2. Run migration to create database tables
3. Regenerate TypeScript client (`CreateClient.bat`)
4. Update frontend views to use generated API clients instead of mock data

### External Dependencies
- Simulation service at `http://localhost:52335/api/Simulation/run`
- Background worker polls queue every 5 seconds
- Results stored in database for analysis

## log
- backend log file is at "G:\SourceCode\MarketWatchWeb_AbpBackEnd\src\MarketWatchWeb.HttpApi.Host\Logs\logs.txt"
